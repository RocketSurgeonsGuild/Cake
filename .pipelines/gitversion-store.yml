parameters:
  targetPath: "$(Build.ArtifactStagingDirectory)/gitversion/"

steps:
  - task: NuGetToolInstaller@0
    displayName: "Get NuGet"
    inputs:
      versionSpec: 4.7.1
  - script: nuget install GitVersion.CommandLine -Version 4.0.0-beta0012 -ExcludeVersion
  - script: ./GitVersion.CommandLine/tools/GitVersion.exe /output buildserver
  - task: RocketSurgeonsGuild.variable-tools.SerializeVariables.SerializeVariables@1
    displayName: "Serialize GitVersion Variables"
    inputs:
      filename: ${{ format('{0}/meta.json', parameters.targetPath) }}
      prefixes: GITVERSION
  - task: PublishPipelineArtifact@0
    displayName: "Publish GitVersion Variables"
    inputs:
      targetPath: ${{ parameters.targetPath }}
